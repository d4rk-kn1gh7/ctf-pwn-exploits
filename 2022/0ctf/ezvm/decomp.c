ssize_t vm_run()
{
  signed __int8 v1; // [rsp+3h] [rbp-2Dh]
  signed __int8 reg_1; // [rsp+3h] [rbp-2Dh]
  signed __int8 reg; // [rsp+3h] [rbp-2Dh]
  signed __int8 rega; // [rsp+3h] [rbp-2Dh]
  signed __int8 regb; // [rsp+3h] [rbp-2Dh]
  int v6; // [rsp+4h] [rbp-2Ch]
  __int64 v7; // [rsp+8h] [rbp-28h]
  __int64 v8; // [rsp+8h] [rbp-28h]
  int *v9; // [rsp+18h] [rbp-18h]
  __int64 v10; // [rsp+20h] [rbp-10h]
  __int64 v11; // [rsp+20h] [rbp-10h]
  __int64 v12; // [rsp+20h] [rbp-10h]

  while ( 2 )
  {
    if ( pc < vm_code_size_5058 )
    {
      v6 = (char)vm_instructions[pc++];
      switch ( v6 )
      {
        case PUSH:
          v1 = vm_instructions[pc++];
          if ( (unsigned __int8)v1 > 3u || stack_size > 255 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size++] = (__int64)registers[v1 + 4];
          continue;
        case POP:
          reg_1 = vm_instructions[pc++];
          if ( (unsigned __int8)reg_1 > 3u || stack_size <= 0 )
            write_strlen_wrapper("oveflow!");
          registers[reg_1 + 4] = (int *)vm_stack[--stack_size];
          continue;
        case ADD:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] += vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case SUB:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] -= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case MUL:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] *= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case DIV:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] /= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case MOD:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] %= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case SHL:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] <<= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case SHR:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] >>= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case AND:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] &= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case OR:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] |= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case XOR:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] ^= vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case IF_TOP:                            // 1 if top is set, else 0
          if ( stack_size <= 0 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 1] = vm_stack[stack_size - 1] == 0;
          continue;
        case JMP:
          v10 = pc + 8 + *(_QWORD *)&vm_instructions[pc];
          if ( v10 < 0 || v10 >= vm_code_size_5058 )
            write_strlen_wrapper("oveflow!");
          pc += 8LL + *(_QWORD *)&vm_instructions[pc];
          continue;
        case JMP_IF_TOP:                        // Jump if top of stack is set
          v11 = pc + 8 + *(_QWORD *)&vm_instructions[pc];
          if ( v11 < 0 || v11 >= vm_code_size_5058 || stack_size <= 0 )
            write_strlen_wrapper("oveflow!");
          if ( vm_stack[--stack_size] )
            pc = v11;
          else
            pc += 8LL;
          continue;
        case JMP_IF_NOT_TOP:                    // JMP if top of stack is not set
          v12 = pc + 8 + *(_QWORD *)&vm_instructions[pc];
          if ( v12 < 0 || v12 >= vm_code_size_5058 || stack_size <= 0 )
            write_strlen_wrapper("oveflow!");
          if ( vm_stack[--stack_size] )
            pc += 8LL;
          else
            pc = v12;
          continue;
        case EQ:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] = vm_stack[stack_size - 2] == vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case LT:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] = vm_stack[stack_size - 2] < vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case GT:
          if ( stack_size <= 1 )
            write_strlen_wrapper("oveflow!");
          vm_stack[stack_size - 2] = vm_stack[stack_size - 2] > vm_stack[stack_size - 1];
          --stack_size;
          continue;
        case SET_REG:
          reg = vm_instructions[pc];
          v9 = *(int **)&vm_instructions[++pc];
          pc += 8LL;
          if ( (unsigned __int8)reg >= 4u )
            write_strlen_wrapper("oveflow!");
          registers[reg + 4] = v9;
          continue;
        case BSS_FROM_REG:
          rega = vm_instructions[pc];
          v7 = *(_QWORD *)&vm_instructions[++pc];
          pc += 8LL;
          if ( (unsigned __int8)rega > 3u || v7 < 0 || v7 >= vm_memory_count_5060 )
            write_strlen_wrapper("oveflow!");
          *(_QWORD *)&registers[0][2 * v7] = registers[rega + 4];
          continue;
        case REG_FROM_BSS:
          regb = vm_instructions[pc];
          v8 = *(_QWORD *)&vm_instructions[++pc];
          pc += 8LL;
          if ( (unsigned __int8)regb > 3u || v8 < 0 || v8 >= 8 * vm_memory_count_5060 / 8 )
            write_strlen_wrapper("oveflow!");
          registers[regb + 4] = *(int **)&registers[0][2 * v8];
          continue;
        case QUIT:
          return write_strlen("finish!");
        default:
          write_strlen("what???");
          continue;
      }
    }
    return write_strlen("finish!");
  }
}