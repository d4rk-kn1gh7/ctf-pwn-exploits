#!/usr/bin/python

from pwn import *
import sys

remote_ip, port = 'pwn.zh3r0.cf', 4242
binary = './build/release/mujs ./exp.js'.split()
brkpts = '''
'''

elf = ELF("build/release/mujs")

context.terminal = ['tmux', 'splitw', '-h']
context.arch = "amd64"
context.log_level = "debug"

re = lambda a: io.recv(a)
reu = lambda a: io.recvuntil(a)
rl = lambda: io.recvline()
s = lambda a: io.send(a)
sl = lambda a: io.sendline(a)
sla = lambda a,b: io.sendlineafter(a,b)
sa = lambda a,b: io.sendafter(a,b)

uu64 = lambda a: u64(a.ljust(8,"\x00"))

if len(sys.argv) > 1:
    io = remote(remote_ip, port)
    context.noptrace = True
    f = open("exp.js", "r")
    data = f.read()
    data += "zh3r0-CTF"
    sla("`zh3r0-CTF'\n", data)
    io.interactive()

else:
    io = process(binary, env = {"LD_PRELOAD" : "./build/release/libjemalloc.so.2"})
    io.interactive()
